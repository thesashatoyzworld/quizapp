---
phase: 05-visual-analytics
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - quiz-app/package.json
  - quiz-app/src/app/page.tsx
  - quiz-app/src/data/quiz.ts
  - quiz-app/src/data/chart-data.ts
  - quiz-app/src/components/results/shared/index.ts
autonomous: true

must_haves:
  truths:
    - "Recharts library is installed and importable"
    - "Quiz category scores are accessible in result components"
    - "Each result type has structured chart data (radar values, financial figures, audience segments)"
  artifacts:
    - path: "quiz-app/src/data/chart-data.ts"
      provides: "Chart data definitions for all 5 result types"
      exports: ["getChartData", "ChartData", "RadarDataPoint", "AudienceSegment"]
    - path: "quiz-app/package.json"
      provides: "Recharts dependency"
      contains: "recharts"
  key_links:
    - from: "quiz-app/src/app/page.tsx"
      to: "result components"
      via: "scores prop passed alongside existing props"
      pattern: "scores=\\{scores\\}"
    - from: "quiz-app/src/data/chart-data.ts"
      to: "quiz-app/src/data/quiz.ts"
      via: "imports Category type"
      pattern: "import.*Category.*from.*quiz"
---

<objective>
Install Recharts, propagate quiz scores to result components, and define structured chart data for all 5 result types.

Purpose: This is the data foundation that all chart components depend on. Without scores reaching result components and without chart data definitions, no visualization work can begin.

Output: Recharts installed, scores flowing to result components, chart-data.ts with all 5 result types' data.
</objective>

<execution_context>
@C:\Users\OTVAJE\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\OTVAJE\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-visual-analytics/05-CONTEXT.md
@.planning/phases/04-result-layout/04-01-SUMMARY.md

Key codebase files:
@quiz-app/src/data/quiz.ts — scoring system, Category type, QuizResult interface, calculateScores(), results array with financials/description
@quiz-app/src/app/page.tsx — quiz flow, scores computed line 52 but not stored in state
@quiz-app/src/components/results/InvisibleResult.tsx — example result component, takes {onPaymentClick, userId, resultId}
@quiz-app/src/components/results/shared/ResultSection.tsx — has slot prop ready for Phase 5
@quiz-app/src/components/results/shared/index.ts — barrel export
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Recharts and propagate scores to result components</name>
  <files>
    quiz-app/package.json
    quiz-app/src/app/page.tsx
    quiz-app/src/components/results/InvisibleResult.tsx
    quiz-app/src/components/results/DoerResult.tsx
    quiz-app/src/components/results/GenerousResult.tsx
    quiz-app/src/components/results/UnstableResult.tsx
    quiz-app/src/components/results/ScaleResult.tsx
  </files>
  <action>
    1. Run `npm install recharts` in quiz-app/ directory.

    2. In page.tsx: Store scores in state alongside result. Currently line 52-54:
       ```
       const scores = calculateScores(newAnswers);
       const quizResult = determineResult(newAnswers, scores);
       setResult(quizResult);
       ```
       Add a `scores` state variable: `const [scores, setScores] = useState<Record<Category, number> | null>(null);`
       Import Category from quiz.ts.
       In handleAnswer, after calculateScores: `setScores(scores);`

    3. In page.tsx lines 309-313: Pass scores to each result component:
       ```tsx
       {result.id === 'invisible' && <InvisibleResult onPaymentClick={() => trackPaymentClick(result.title)} userId={userId} resultId={result.id} scores={scores} />}
       ```
       Same for all 5 result components.

    4. Update ResultProps interface in ALL 5 result components to accept optional scores:
       ```tsx
       import { Category } from '@/data/quiz';

       interface ResultProps {
         onPaymentClick?: () => void;
         userId?: number | null;
         resultId?: string;
         scores?: Record<Category, number> | null;
       }
       ```
       Destructure `scores` in each component function but don't use it yet (future plans will use it).

    Do NOT change any visual output. This is pure data plumbing.
  </action>
  <verify>
    Run `cd quiz-app && npm run build` — must succeed with zero errors.
    Check that `recharts` appears in package.json dependencies.
    Grep for `scores={scores}` in page.tsx to confirm prop passing.
    Grep for `scores?:` in all 5 result components to confirm interface update.
  </verify>
  <done>
    Recharts installed. All 5 result components receive scores prop. Build passes. No visual changes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create chart data definitions for all 5 result types</name>
  <files>
    quiz-app/src/data/chart-data.ts
  </files>
  <action>
    Create `quiz-app/src/data/chart-data.ts` with TypeScript interfaces and data for all 5 result types.

    Define these types:
    ```tsx
    import { Category } from './quiz';

    export interface RadarDataPoint {
      category: string;       // Short Russian label
      fullName: string;       // Full category name
      value: number;          // 0-100 normalized score
      maxValue: number;       // Always 100
    }

    export interface AudienceSegment {
      name: string;           // Russian label
      value: number;          // Percentage
      color: string;          // Hex color from cyberpunk palette
    }

    export interface FinancialData {
      currentIncome: number;        // Current estimated monthly income from social
      potentialIncome: number;      // Potential with proper content
      lostPerMonth: number;         // Monthly gap
      label: string;                // "Потенциал роста" label text
    }

    export interface LevelData {
      level: number;                // 1-5
      name: string;                 // Russian result name
      allLevels: { level: number; name: string; id: Category }[];  // Full 5-level path
    }

    export interface ChartData {
      radar: RadarDataPoint[];
      audience: AudienceSegment[];
      financial: FinancialData;
      levelData: LevelData;
    }
    ```

    Create function `getChartData(resultId: Category, scores: Record<Category, number>): ChartData`

    The radar chart uses actual quiz scores normalized to 0-100 scale. Max possible per category is ~240 (8 questions * 30 avg). Normalize: `Math.round((score / 240) * 100)`. Use clamping to 100 max.

    The 5 radar categories with SHORT Russian labels (from CONTEXT.md):
    - invisible -> "Контент" (Content Quality)
    - doer -> "Клиенты" (Client Understanding)
    - generous -> "Посыл" (Messaging Clarity)
    - unstable -> "Структура" (Sales Structure)
    - scale -> "Действия" (Action Capability)

    For audience segments, derive from quiz.ts results array descriptions:
    - invisible: {Рекомендации: 85, Случайные: 15} (almost all from word of mouth)
    - doer: {Случайные: 60, Любопытные: 30, Клиенты: 10}
    - generous: {Студенты: 85, Клиенты: 15} (from description "~85% — студенты, ~15% — клиенты")
    - unstable: {Клиенты: 45, Случайные: 35, Студенты: 20}
    - scale: {Клиенты: 75, Случайные: 25} (from description "~75% — клиенты, ~25% — случайные")

    Colors for audience segments from cyberpunk palette:
    - Клиенты: #00f0ff (cyan)
    - Студенты: #ff00aa (magenta)
    - Случайные: #9d4edd (purple)
    - Рекомендации: #ffd700 (gold)
    - Любопытные: #00ff88 (green)

    For financial data, extract from quiz.ts results array `financials` field:
    - invisible: currentIncome ~0-45000 (0-3 заявки * 15000), potential ~225000-375000 (15-25 заявки * 15000), lost 200000-400000
    - doer: currentIncome ~15000-45000, potential ~225000-375000, lost 200000-400000
    - generous: lost 180000-450000, use midpoint
    - unstable: good months 8-15 * 15000, bad 2-4 * 15000, lost 80000-200000
    - scale: lost 300000-800000

    Use midpoints for all ranges. Store as round numbers.

    For level data, all result types share the same 5-level path:
    ```
    allLevels: [
      { level: 1, name: 'Невидимый эксперт', id: 'invisible' },
      { level: 2, name: 'Делатель', id: 'doer' },
      { level: 3, name: 'Щедрый эксперт', id: 'generous' },
      { level: 4, name: 'Нестабильный', id: 'unstable' },
      { level: 5, name: 'Готовы к масштабированию', id: 'scale' },
    ]
    ```
    The current level is determined by resultId mapping to stage number from quiz.ts.

    Export the function and all types.
  </action>
  <verify>
    Run `cd quiz-app && npx tsc --noEmit` — no type errors.
    Verify file exports: getChartData, ChartData, RadarDataPoint, AudienceSegment, FinancialData, LevelData.
  </verify>
  <done>
    chart-data.ts exists with complete typed data for all 5 result types. Radar uses real scores, audience/financial use result-specific hardcoded data. TypeScript compiles cleanly.
  </done>
</task>

</tasks>

<verification>
1. `cd quiz-app && npm run build` passes
2. `recharts` in package.json dependencies
3. `scores` state in page.tsx, passed to all 5 result components
4. `chart-data.ts` exports getChartData with correct types
5. No visual changes to existing result pages
</verification>

<success_criteria>
- Recharts is installed and appears in package.json
- Quiz scores are stored in page.tsx state and passed to all 5 result components
- chart-data.ts provides typed chart data for all 5 result types
- Build succeeds with no errors
- Existing result pages render identically (no visual regression)
</success_criteria>

<output>
After completion, create `.planning/phases/05-visual-analytics/05-01-SUMMARY.md`
</output>
