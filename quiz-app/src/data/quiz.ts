// Quiz Categories
export type Category = 'invisible' | 'doer' | 'generous' | 'unstable' | 'scale';

// Scoring rules per question
// Format: [invisible, doer, generous, unstable, scale]
export const scoringRules: Record<number, number[][]> = {
  1: [
    [30, 0, 0, 0, 0],      // Option 1 → Невидимка +30
    [0, 30, 0, 0, 0],      // Option 2 → Делатель +30
    [0, 0, 30, 0, 0],      // Option 3 → Щедрый +30
    [0, 0, 0, 15, 5],      // Option 4 → Нестабильные +15, Масштаб +5
  ],
  2: [
    [0, 0, 35, 0, 0],      // Option 1 → Щедрый +35
    [0, 25, 0, 0, 0],      // Option 2 → Делатель +25
    [0, 0, 0, 25, 0],      // Option 3 → Нестабильные +25
    [0, 0, 0, 0, 10],      // Option 4 → Масштаб +10
  ],
  3: [
    [30, 0, 0, 0, 0],      // Option 1 → Невидимка +30
    [0, 30, 0, 0, 0],      // Option 2 → Делатель +30
    [0, 0, 35, 0, 0],      // Option 3 → Щедрый +35
    [0, 0, 0, 30, 0],      // Option 4 → Нестабильные +30
  ],
  4: [
    [30, 0, 0, 0, 0],      // Option 1 → Невидимка +30
    [0, 35, 0, 0, 0],      // Option 2 → Делатель +35
    [0, 0, 30, 0, 0],      // Option 3 → Щедрый +30
    [0, 0, 0, 15, 5],      // Option 4 → Нестабильные +15, Масштаб +5
  ],
  5: [
    [20, 0, 20, 0, 0],     // Option 1 → Невидимка +20, Щедрый +20
    [0, 30, 0, 0, 0],      // Option 2 → Делатель +30
    [0, 0, 35, 0, 0],      // Option 3 → Щедрый +35
    [0, 0, 0, 20, 5],      // Option 4 → Нестабильные +20, Масштаб +5
  ],
  6: [
    [35, 0, 0, 0, 0],      // Option 1 → Невидимка +35
    [0, 35, 0, 0, 0],      // Option 2 → Делатель +35
    [0, 0, 35, 0, 0],      // Option 3 → Щедрый +35
    [0, 0, 0, 35, 0],      // Option 4 → Нестабильные +35
  ],
  7: [
    [30, 0, 0, 0, 0],      // Option 1 → Невидимка +30
    [0, 30, 0, 0, 0],      // Option 2 → Делатель +30
    [0, 0, 30, 0, 0],      // Option 3 → Щедрый +30
    [0, 0, 0, 15, 5],      // Option 4 → Нестабильные +15, Масштаб +5
  ],
  8: [
    [35, 0, 0, 0, 0],      // Option 1 → Невидимка +35
    [0, 35, 0, 0, 0],      // Option 2 → Делатель +35
    [0, 0, 30, 0, 0],      // Option 3 → Щедрый +30
    [0, 0, 0, 20, 10],     // Option 4 → Нестабильные +20, Масштаб +10
  ],
};

export const questions = [
  {
    id: 1,
    text: "Сколько контента о своей работе вы публикуете?",
    options: [
      "Мало или очень редко — боюсь/стесняюсь или не знаю что писать",
      "Много — пробую разное, но результата нет",
      "Регулярно — даю полезный/обучающий контент",
      "Регулярно — есть система, показываю результаты и процесс"
    ]
  },
  {
    id: 2,
    text: "Как вы относитесь к продажам и продающему контенту?",
    options: [
      "Стесняюсь продавать, боюсь выглядеть \"инфоцыганом\"",
      "Не знаю как правильно продавать через контент",
      "Понимаю важность, но не всегда получается",
      "Продаю спокойно и системно"
    ]
  },
  {
    id: 3,
    text: "Что происходит с заявками из контента?",
    options: [
      "Заявок почти нет — контента мало или он не про работу",
      "Заявок почти нет — делаю контент, но не работает",
      "Много лайков/сохранений, но не пишут в директ",
      "То густо, то пусто — непредсказуемо"
    ]
  },
  {
    id: 4,
    text: "Сколько обучений по контенту/продажам вы прошли?",
    options: [
      "Почти не учился — вообще не занимаюсь контентом системно",
      "Много — постоянно ищу \"волшебную таблетку\", но не работает",
      "Несколько — нашёл \"давай пользу\", делаю так",
      "Учился, нашёл что работает, применяю"
    ]
  },
  {
    id: 5,
    text: "Как люди реагируют на ваше предложение услуг?",
    options: [
      "Почти не предлагаю — стесняюсь или не знаю как",
      "Предлагаю, но люди не покупают — не понимаю почему",
      "\"Попробую сам по вашим материалам\" / \"Дорого\"",
      "Стабильно конвертируются или то густо, то пусто"
    ]
  },
  {
    id: 6,
    text: "Что вы чувствуете по поводу контента?",
    options: [
      "Не делаю системно — клиенты только по рекомендациям",
      "Делаю много, но выгорание — ничего не работает",
      "Даю ценность, а не покупают — не понимаю почему",
      "Когда активен — работает, расслабился — падает"
    ]
  },
  {
    id: 7,
    text: "Как вы описали бы свой подход к контенту?",
    options: [
      "Почти не делаю или делаю редко, интуитивно",
      "Пробую разные форматы/шаблоны — ищу что сработает",
      "Даю пошаговые инструкции, учу делать самостоятельно",
      "Показываю результаты, кейсы, диагностирую проблемы"
    ]
  },
  {
    id: 8,
    text: "Есть ли у вас система в контенте?",
    options: [
      "Нет системы — вообще не занимаюсь контентом",
      "Нет системы — пробую всё подряд, копирую шаблоны",
      "Есть система — регулярно даю полезный контент",
      "Есть система — она работает, но хочу стабильности/масштаба"
    ]
  }
];

export interface QuizResult {
  id: Category;
  stage: number;
  title: string;
  keyword: string;
  description: string;
  financials: string;
  reason: string;
  isNormal: string;
  nextSteps: string[];
}

export const results: QuizResult[] = [
  {
    id: 'invisible',
    stage: 1,
    title: "Эксперт-невидимка",
    keyword: "ВИДИМОСТЬ",
    description: "Вы крутой специалист, но о вас не знают в соцсетях. Контента мало или он не про работу.",
    financials: "Теряете 200 000 - 400 000₽/месяц из соцсетей.\n\nМогли бы: 15-25 заявок/месяц\nПолучаете: 0-3 заявки",
    reason: "Боитесь/стесняетесь или не знаете что писать.",
    isNormal: "Да. Первый этап пути к личному бренду.",
    nextSteps: [
      "Как стать видимым без перегруза",
      "Что показывать про работу",
      "Система регулярности (15-20 мин/день)",
      "Кейсы трансформации",
      "Первые 3 шага, чтобы внедрить Продающий Контент именно в вашей ситуации"
    ]
  },
  {
    id: 'doer',
    stage: 2,
    title: "Делатель без системы",
    keyword: "ФОКУС",
    description: "Много делаете, пробуете разное, ходите по обучениям. Всё хаотично. Результата нет.",
    financials: "Теряете 200 000 - 400 000₽/месяц из соцсетей.\n\nПлюс потратили 100 000 - 300 000₽ на обучения без результата.\n\nМогли бы: 15-25 заявок/месяц\nПолучаете: 1-3 заявки",
    reason: "Нет системы. Пробуете кусочки, не собираете в целое. Шаблоны не работают без механики.",
    isNormal: "Да. 60% проходят эту стадию. Второй этап пути.",
    nextSteps: [
      "Как собрать систему из хаоса",
      "Единая механика контента",
      "Как перестать гнаться за быстрыми результатами",
      "Кейсы нашедших систему",
      "Первые 3 шага, чтобы получить результаты в контенте уже в ближайшие 14 дней"
    ]
  },
  {
    id: 'generous',
    stage: 3,
    title: "Щедрый эксперт",
    keyword: "ЭКСПЕРТ",
    description: "Нашли систему: \"давай полезный контент\". Контент привлекает тех, кто хочет научиться, а не делегировать.\n\n~85% аудитории — студенты\n~15% — клиенты\n\nДополнительно: Скорее всего стесняетесь продавать. \"Фу, инфоцыган\" — знакомо? Пытаетесь быть хорошим, чтобы за это платили.",
    financials: "Из 1000 человек охвата:\n\nОбратятся: 3-8\nГотовы платить: 1-3\n\nНедополучаете: 180 000 - 450 000₽/месяц",
    reason: "Контент обучает, не диагностирует проблему. Не приняли что продажа = помощь.",
    isNormal: "Да. 73% проходят эту стадию. Третий этап — нашли систему, но неправильную.",
    nextSteps: [
      "Паттерны создающие студентов",
      "Финансовый прогноз 6-12 месяцев",
      "3 стратегических сдвига",
      "Как принять что продажа = помощь",
      "Первые 3 шага, чтобы уже в ближайшие 14 дней внедрить продающий контент"
    ]
  },
  {
    id: 'unstable',
    stage: 4,
    title: "Нестабильные результаты",
    keyword: "СИСТЕМА",
    description: "То густо, то пусто. В ударе — работает. Расслабились — падает.\n\nВозможно:\n• Не до конца приняли что хотите зарабатывать\n• Стесняетесь делать продающий контент системно\n• Попадаете интуитивно, не системно",
    financials: "Хорошие месяцы: 8-15 обращений\nПлохие: 2-4 обращения\n\nНедополучаете: 80 000 - 200 000₽/месяц",
    reason: "Нет системы — полагаетесь на интуицию и настроение. Не оцифровали воронку.",
    isNormal: "Да. Нашли механику, не структурировали. Четвёртый этап — почти у цели.",
    nextSteps: [
      "Интуиция → система",
      "Потери от нестабильности за год",
      "Алгоритм стабилизации",
      "Как оцифровать воронку",
      "Первые 3 шага, чтобы исправить ситуацию и получить результаты в ближайший 14 дней"
    ]
  },
  {
    id: 'scale',
    stage: 5,
    title: "Готовы к масштабированию",
    keyword: "МАСШТАБ",
    description: "Контент работает стабильно.\n\n~75% аудитории — клиенты\n~25% — случайные",
    financials: "Из 1000 охвата:\n\nОбращаются: 15-25\nКонверсия: 60-80%\n\nОграничение: Потолок личного времени. Выручка растёт линейно, не экспоненциально.\n\nУпущенный потенциал: 300 000 - 800 000₽++ / месяц",
    reason: "Модель сольная. Выжали максимум из \"один эксперт = один поток\".",
    isNormal: "Да. Топ-15% экспертов. Пятый этап — следующая стадия масштабирование системы.",
    nextSteps: [
      "Масштабирование без роста времени",
      "Потенциал при масштабировании",
      "Умножение контента, автоматизация",
      "Продуктовая линейка",
      "Следующие 3 шага для того, чтобы разгрузить себя и начать заниматься ростом своего проекта"
    ]
  }
];

// Calculate scores from answers
export function calculateScores(answers: number[]): Record<Category, number> {
  const scores: Record<Category, number> = {
    invisible: 0,
    doer: 0,
    generous: 0,
    unstable: 0,
    scale: 0
  };

  const categories: Category[] = ['invisible', 'doer', 'generous', 'unstable', 'scale'];

  answers.forEach((answer, index) => {
    const questionNumber = index + 1;
    const rule = scoringRules[questionNumber]?.[answer];
    if (rule) {
      categories.forEach((cat, catIndex) => {
        scores[cat] += rule[catIndex];
      });
    }
  });

  return scores;
}

// Determine result based on scores and special rules
export function determineResult(answers: number[], scores: Record<Category, number>): QuizResult {
  // Special rule for Scale: need 40+ points AND answer 4 (index 3) on questions 1, 2, 8
  const scaleQualified =
    scores.scale >= 40 &&
    answers[0] === 3 && // Q1 answer 4 (0-indexed = 3)
    answers[1] === 3 && // Q2 answer 4
    answers[7] === 3;   // Q8 answer 4

  if (scaleQualified) {
    return results.find(r => r.id === 'scale')!;
  }

  // Otherwise, find category with max score (excluding scale)
  const categoriesWithoutScale: Category[] = ['invisible', 'doer', 'generous', 'unstable'];
  let maxCategory: Category = 'invisible';
  let maxScore = 0;

  categoriesWithoutScale.forEach(cat => {
    if (scores[cat] > maxScore) {
      maxScore = scores[cat];
      maxCategory = cat;
    }
  });

  return results.find(r => r.id === maxCategory)!;
}
