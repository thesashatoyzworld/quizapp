---
phase: 05-visual-analytics
plan: 03
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - quiz-app/src/components/charts/FinancialGauge.tsx
  - quiz-app/src/components/charts/AudienceDonut.tsx
  - quiz-app/src/components/charts/index.ts
  - quiz-app/src/app/globals.css
autonomous: true

must_haves:
  truths:
    - "Financial gauge shows growth potential in rubles with animated progress indicator"
    - "Donut chart shows audience composition breakdown with colored segments and labels"
    - "Both charts display numeric values alongside visual representation"
  artifacts:
    - path: "quiz-app/src/components/charts/FinancialGauge.tsx"
      provides: "Financial growth potential visualization"
      exports: ["FinancialGauge"]
    - path: "quiz-app/src/components/charts/AudienceDonut.tsx"
      provides: "Audience composition donut chart"
      exports: ["AudienceDonut"]
  key_links:
    - from: "quiz-app/src/components/charts/FinancialGauge.tsx"
      to: "quiz-app/src/data/chart-data.ts"
      via: "consumes FinancialData type"
      pattern: "FinancialData"
    - from: "quiz-app/src/components/charts/AudienceDonut.tsx"
      to: "recharts"
      via: "PieChart/Pie components"
      pattern: "import.*from.*recharts"
---

<objective>
Create the financial gauge component (VIZ-03) and audience donut chart component (VIZ-04) with cyberpunk neon styling.

Purpose: These visualizations make abstract financial data and audience composition concrete and visual. The financial gauge shows "growth potential" (positive framing) and the donut chart reveals audience quality.

Output: 2 chart components (FinancialGauge, AudienceDonut) with cyberpunk styling, ready for integration.
</objective>

<execution_context>
@C:\Users\OTVAJE\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\OTVAJE\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-visual-analytics/05-CONTEXT.md
@.planning/phases/05-visual-analytics/05-01-SUMMARY.md

Key codebase files:
@quiz-app/src/data/chart-data.ts — FinancialData, AudienceSegment types (created by Plan 01)
@quiz-app/src/app/globals.css — existing CSS variables, cyberpunk palette, chart-container class from Plan 02
@quiz-app/src/components/charts/index.ts — barrel export to update
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FinancialGauge component</name>
  <files>
    quiz-app/src/components/charts/FinancialGauge.tsx
    quiz-app/src/app/globals.css
  </files>
  <action>
    Create `quiz-app/src/components/charts/FinancialGauge.tsx`:

    ```tsx
    'use client';
    ```

    Props:
    ```tsx
    import { FinancialData } from '@/data/chart-data';

    interface FinancialGaugeProps {
      data: FinancialData;
      accentColor?: string;  // Default: '#ffd700' (gold)
    }
    ```

    This is a CUSTOM SVG component, NOT using Recharts. Recharts doesn't have a good gauge/semicircle component. Build it with raw SVG + CSS animations.

    Visual design — semicircular gauge (half-donut):
    - SVG viewBox: "0 0 200 120" (semicircle fits nicely)
    - Background arc: stroke rgba(255,255,255,0.1), strokeWidth 18
    - Filled arc: stroke gradient from current position (muted) to potential (gold/green)
    - The arc represents the range from 0 to potentialIncome
    - Current income fills the arc partially, showing how much room for growth
    - Fill percentage: `(currentIncome / potentialIncome) * 100`
    - Arc uses strokeDasharray/strokeDashoffset for animation (animate from 0 to target over 1.5s)

    Center of semicircle (below arc):
    - Large text showing potentialIncome formatted as "XXX 000 P/мес" in Orbitron, gold color, with glow
    - Smaller text below: data.label ("Потенциал роста")

    Below the gauge, show two metric boxes side by side:
    - Left box: "Сейчас" with currentIncome formatted as "XX 000 P/мес" — muted/dim styling
    - Right box: "Потенциал" with potentialIncome — gold/bright styling
    - Both use Orbitron font for numbers

    Format rubles: Use space as thousands separator (e.g., "300 000"). Add "P" symbol (or "руб."). Helper function: `formatRubles(n: number): string`

    Animate the number counter from 0 to target value using a useEffect + requestAnimationFrame counter that runs over 1.5s. Start animation when component mounts (no intersection observer needed — charts will be inside slots which handle visibility).

    Wrap in `chart-container` class div. Title: "Потенциал роста" in chart-title style.

    Add to globals.css (append to Chart Components section):
    ```css
    .gauge-metrics {
      display: flex;
      justify-content: space-between;
      gap: var(--space-sm);
      margin-top: var(--space-md);
    }

    .gauge-metric-box {
      flex: 1;
      text-align: center;
      padding: var(--space-sm);
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.05);
    }

    .gauge-metric-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .gauge-metric-value {
      font-family: var(--font-display);
      font-size: 1.1rem;
      font-weight: 700;
    }
    ```
  </action>
  <verify>
    Run `cd quiz-app && npx tsc --noEmit` — no type errors.
    Verify FinancialGauge.tsx exports FinancialGauge component.
    Verify it does NOT import from recharts (custom SVG implementation).
  </verify>
  <done>
    FinancialGauge renders semicircular gauge showing growth potential in rubles with animated fill and counter animation. Uses custom SVG, not Recharts. Gold accent with neon glow.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create AudienceDonut component and update barrel export</name>
  <files>
    quiz-app/src/components/charts/AudienceDonut.tsx
    quiz-app/src/components/charts/index.ts
    quiz-app/src/app/globals.css
  </files>
  <action>
    Create `quiz-app/src/components/charts/AudienceDonut.tsx`:

    ```tsx
    'use client';
    ```

    Props:
    ```tsx
    import { AudienceSegment } from '@/data/chart-data';

    interface AudienceDonutProps {
      data: AudienceSegment[];
      accentColor?: string;
    }
    ```

    Use Recharts components: `PieChart`, `Pie`, `Cell`, `ResponsiveContainer`, `Tooltip`.

    Implementation:
    - ResponsiveContainer width="100%" height={250}
    - PieChart with single Pie: dataKey="value", nameKey="name"
    - innerRadius="55%", outerRadius="80%" (donut, not full pie)
    - Each Cell gets its color from the AudienceSegment.color field
    - Stroke on cells: transparent (no divider lines — cleaner look)
    - Animation: animationDuration={1500}, animationEasing="ease-out"

    Center label (inside the donut hole):
    - Use a custom label positioned at center of pie
    - Show "Аудитория" text in small Orbitron
    - Below: the percentage of the largest segment in large bold text with its color

    Legend below the chart:
    - Horizontal flex wrap layout
    - Each item: colored dot (12px circle) + segment name + percentage in brackets
    - Use segment colors from data
    - Font: body font for name, Orbitron for percentage
    - Gap between items: var(--space-sm)

    Custom tooltip: "Segment: XX%" with cyberpunk dark background styling.

    Neon glow: Apply drop-shadow filter matching the dominant segment's color.

    Wrap in `chart-container` class div. Title: "Состав аудитории" in chart-title style.

    **Update barrel export** (`quiz-app/src/components/charts/index.ts`):
    Add to existing exports:
    ```tsx
    export { FinancialGauge } from './FinancialGauge';
    export { AudienceDonut } from './AudienceDonut';
    ```

    Now the barrel export has all 5 components: RadarChart, LevelBadge, LevelPath, FinancialGauge, AudienceDonut.

    **CSS additions** to globals.css (append to Chart Components section):
    ```css
    .donut-legend {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: var(--space-sm);
      margin-top: var(--space-md);
    }

    .donut-legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.85rem;
    }

    .donut-legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .donut-legend-pct {
      font-family: var(--font-display);
      font-size: 0.8rem;
    }

    /* Recharts tooltip override for cyberpunk style */
    .recharts-tooltip-wrapper .recharts-default-tooltip {
      background: rgba(10, 6, 18, 0.95) !important;
      border: 1px solid rgba(157, 78, 221, 0.5) !important;
      border-radius: 8px !important;
      font-family: var(--font-body) !important;
    }
    ```
  </action>
  <verify>
    Run `cd quiz-app && npm run build` — build succeeds.
    Verify all 5 components exported from charts/index.ts: RadarChart, LevelBadge, LevelPath, FinancialGauge, AudienceDonut.
    Verify AudienceDonut imports from recharts (PieChart).
    Verify FinancialGauge does NOT import from recharts.
  </verify>
  <done>
    AudienceDonut renders donut chart with colored segments, center label, and custom legend. Barrel export updated with all 5 chart components. Recharts tooltip CSS override added. Build passes.
  </done>
</task>

</tasks>

<verification>
1. `cd quiz-app && npm run build` passes
2. FinancialGauge: custom SVG semicircular gauge with animated fill and counter
3. AudienceDonut: Recharts donut with colored segments and legend
4. Both wrapped in chart-container with chart-title
5. Both accept typed props from chart-data.ts
6. Barrel export has all 5 chart components
7. New CSS classes for gauge metrics, donut legend, tooltip override
</verification>

<success_criteria>
- FinancialGauge shows growth potential as semicircular gauge with ruble formatting (VIZ-03)
- AudienceDonut shows audience composition as donut chart with legend (VIZ-04)
- Both responsive for 480px viewport
- Build passes, no type errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-visual-analytics/05-03-SUMMARY.md`
</output>
