---
phase: 05-visual-analytics
plan: 04
type: execute
wave: 3
depends_on: ["05-02", "05-03"]
files_modified:
  - quiz-app/src/components/results/InvisibleResult.tsx
  - quiz-app/src/components/results/DoerResult.tsx
  - quiz-app/src/components/results/GenerousResult.tsx
  - quiz-app/src/components/results/UnstableResult.tsx
  - quiz-app/src/components/results/ScaleResult.tsx
  - quiz-app/src/app/globals.css
autonomous: false

must_haves:
  truths:
    - "User sees radar chart in profile/intro section of their result page"
    - "User sees level badge and level path after the radar chart"
    - "User sees financial gauge in the financial/consequences section"
    - "User sees audience donut chart in the relevant audience section"
    - "Charts do not disrupt reading flow or overshadow CTA buttons"
    - "Charts render correctly on 480px Telegram WebApp viewport"
  artifacts:
    - path: "quiz-app/src/components/results/InvisibleResult.tsx"
      provides: "Result page with integrated charts"
      contains: "RadarChart"
    - path: "quiz-app/src/components/results/DoerResult.tsx"
      provides: "Result page with integrated charts"
      contains: "RadarChart"
    - path: "quiz-app/src/components/results/GenerousResult.tsx"
      provides: "Result page with integrated charts"
      contains: "RadarChart"
    - path: "quiz-app/src/components/results/UnstableResult.tsx"
      provides: "Result page with integrated charts"
      contains: "RadarChart"
    - path: "quiz-app/src/components/results/ScaleResult.tsx"
      provides: "Result page with integrated charts"
      contains: "RadarChart"
  key_links:
    - from: "quiz-app/src/components/results/InvisibleResult.tsx"
      to: "quiz-app/src/components/charts/index.ts"
      via: "imports chart components"
      pattern: "import.*from.*charts"
    - from: "quiz-app/src/components/results/InvisibleResult.tsx"
      to: "quiz-app/src/data/chart-data.ts"
      via: "calls getChartData with scores"
      pattern: "getChartData"
---

<objective>
Integrate all chart components into all 5 result pages using the ResultSection slot prop, completing VIZ-05 (layout integration).

Purpose: This is the final assembly step. Charts created in Plans 02-03 get wired into the actual result pages where users see them. Charts are spread across relevant sections (NOT grouped in one dashboard block), following the layout decisions from CONTEXT.md.

Output: All 5 result pages display radar chart, level badge, level path, financial gauge, and audience donut chart in their respective sections.
</objective>

<execution_context>
@C:\Users\OTVAJE\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\OTVAJE\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-visual-analytics/05-CONTEXT.md
@.planning/phases/05-visual-analytics/05-01-SUMMARY.md
@.planning/phases/05-visual-analytics/05-02-SUMMARY.md
@.planning/phases/05-visual-analytics/05-03-SUMMARY.md

Key codebase files:
@quiz-app/src/components/results/InvisibleResult.tsx — example result page to modify
@quiz-app/src/components/results/shared/ResultSection.tsx — slot prop for chart injection
@quiz-app/src/components/charts/index.ts — all 5 chart component exports
@quiz-app/src/data/chart-data.ts — getChartData function
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate charts into all 5 result pages</name>
  <files>
    quiz-app/src/components/results/InvisibleResult.tsx
    quiz-app/src/components/results/DoerResult.tsx
    quiz-app/src/components/results/GenerousResult.tsx
    quiz-app/src/components/results/UnstableResult.tsx
    quiz-app/src/components/results/ScaleResult.tsx
    quiz-app/src/app/globals.css
  </files>
  <action>
    For EACH of the 5 result components, apply the same integration pattern:

    **1. Add imports at top of file:**
    ```tsx
    import { RadarChart, LevelBadge, LevelPath, FinancialGauge, AudienceDonut } from '../charts';
    import { getChartData } from '@/data/chart-data';
    ```

    **2. Inside the component function, compute chart data:**
    ```tsx
    const chartData = scores ? getChartData(resultId as Category, scores) : null;
    ```
    Import `Category` from `@/data/quiz` (already imported from Plan 01).

    **3. Chart placement per CONTEXT.md layout decisions:**

    Charts go in specific ResultSection `slot` props. The placement follows the CONTEXT.md rule: "Charts spread across relevant sections."

    **Section mapping for all result pages:**

    a) **First ResultSection (intro/profile section)** — inject radar + level:
       Add `slot` prop with radar chart + level badge + level path:
       ```tsx
       <ResultSection
         title="Вот что происходит..."
         id="profile-section"
         slot={chartData ? (
           <div className="result-chart-slot">
             <LevelBadge levelData={chartData.levelData} accentColor={accentColorVar} />
             <RadarChart data={chartData.radar} accentColor={accentColorHex} />
             <LevelPath levelData={chartData.levelData} accentColor={accentColorHex} />
           </div>
         ) : undefined}
       >
       ```

    b) **Financial section** (the section discussing losses/potential — varies per result):
       - InvisibleResult: "ЧТО НА САМОМ ДЕЛЕ ПРОИСХОДИТ?" section
       - DoerResult: the section with financial losses content
       - GenerousResult: financial consequences section
       - UnstableResult: the "то густо, то пусто" financial section
       - ScaleResult: the scaling potential section

       Add `slot` prop:
       ```tsx
       slot={chartData ? (
         <div className="result-chart-slot">
           <FinancialGauge data={chartData.financial} />
         </div>
       ) : undefined}
       ```

    c) **Audience-relevant section** (varies per result — wherever audience composition is discussed):
       - InvisibleResult: in the "Почему это происходит" section (visibility/audience theme)
       - DoerResult: in the chaotic content section
       - GenerousResult: in the "85% студенты" section (this one explicitly mentions audience)
       - UnstableResult: in the pattern analysis section
       - ScaleResult: in the scaling audience section

       Add `slot` prop:
       ```tsx
       slot={chartData ? (
         <div className="result-chart-slot">
           <AudienceDonut data={chartData.audience} />
         </div>
       ) : undefined}
       ```

    **4. Accent colors per result type:**
    Each result type gets a distinct accent color from the cyberpunk palette:
    - invisible: '#ff00aa' (magenta — matches existing ResultHeader default)
    - doer: '#00f0ff' (cyan)
    - generous: '#9d4edd' (purple)
    - unstable: '#ffd700' (gold)
    - scale: '#00ff88' (green)

    Store as const at top of each component:
    ```tsx
    const ACCENT_COLOR = '#ff00aa'; // per result type
    ```

    Pass to chart components as `accentColor` prop. Also pass to `ResultHeader` `accentColor` prop if not already set.

    **5. Important constraints:**
    - Keep ALL existing text content exactly as-is
    - Charts inject via `slot` prop ONLY — do not restructure ResultSection children
    - Charts appear BETWEEN the section title and the section content (that's how the slot prop works in ResultSection)
    - If scores is null/undefined, render NO charts (graceful fallback — page looks exactly like before)
    - Do NOT put multiple charts in the same slot unless they belong together (radar + level go together in profile section)

    **6. CSS fine-tuning:**
    Add to globals.css Chart Components section:
    ```css
    /* Chart slot spacing within result sections */
    .result-chart-slot {
      margin: var(--space-lg) 0;
      min-height: 0;
    }

    .result-chart-slot > * + * {
      margin-top: var(--space-lg);
    }

    /* Ensure charts don't overflow on mobile */
    .result-chart-slot .recharts-responsive-container {
      max-width: 100%;
    }

    /* Reduce chart padding on very small screens */
    @media (max-width: 480px) {
      .chart-container {
        padding: var(--space-sm);
      }

      .chart-title {
        font-size: 0.75rem;
      }

      .gauge-metric-value {
        font-size: 0.95rem;
      }
    }
    ```

    Note: The existing `.result-chart-slot` CSS (line 633 of globals.css) should be REPLACED with the updated version above (same class, updated properties).
  </action>
  <verify>
    Run `cd quiz-app && npm run build` — build succeeds.
    Grep for "RadarChart" in all 5 result files — each must contain it.
    Grep for "getChartData" in all 5 result files — each must contain it.
    Grep for "FinancialGauge" in all 5 result files — each must contain it.
    Grep for "AudienceDonut" in all 5 result files — each must contain it.
    Verify no result file has more than ~400 lines (integration adds ~20-30 lines max per file).
  </verify>
  <done>
    All 5 result pages integrate all chart components via slot props. Radar + level in profile section, financial gauge in financial section, donut in audience section. Graceful fallback when scores unavailable. Mobile-responsive chart styling. Build passes.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete visual analytics system integrated into all 5 quiz result pages:
    - Radar chart showing 5-category expert profile
    - Level badge with neon glow showing current level (1-5)
    - Level path showing all 5 levels with current highlighted
    - Financial semicircular gauge showing growth potential in rubles
    - Audience composition donut chart with colored segments
    All in cyberpunk neon style matching SlideForge visual DNA.
  </what-built>
  <how-to-verify>
    1. Run `cd quiz-app && npm run dev` to start the dev server
    2. Open the quiz at http://localhost:3000
    3. Complete the quiz (answer all 8 questions)
    4. After subscription check, view the result page
    5. Verify the following on the result page:
       a. After the first section title, you see a neon level badge ("Уровень N: Name")
       b. Below that, a radar chart with 5 axes and neon glow
       c. Below radar, a 5-level path with your level highlighted
       d. In the financial section, a semicircular gauge with ruble amounts
       e. In another section, a donut chart showing audience composition
    6. Scroll through the entire page — verify charts don't disrupt text flow
    7. Verify CTA/payment button at bottom is still prominent and not overshadowed
    8. Check on mobile viewport (use DevTools, set to 480px width for Telegram simulation)
    9. Verify charts are readable and not cut off on mobile
    10. Try at least 2 different quiz answer combinations to see different result types
  </how-to-verify>
  <resume-signal>Type "approved" if charts look good, or describe specific issues (e.g., "radar too large on mobile", "gauge numbers unreadable", "donut colors too similar")</resume-signal>
</task>

</tasks>

<verification>
1. `cd quiz-app && npm run build` passes
2. All 5 result pages contain RadarChart, LevelBadge, LevelPath, FinancialGauge, AudienceDonut
3. Charts placed in correct sections (profile, financial, audience)
4. Charts use result-specific accent colors
5. Graceful fallback when scores unavailable
6. Mobile-responsive at 480px
7. Human verified visual quality and reading flow
</verification>

<success_criteria>
- All 5 requirements met: VIZ-01 (radar), VIZ-02 (level), VIZ-03 (gauge), VIZ-04 (donut), VIZ-05 (integration)
- Charts integrated into result pages without disrupting reading flow
- CTA buttons remain prominent
- Responsive on 480px Telegram WebApp viewport
- Human approval of visual quality
</success_criteria>

<output>
After completion, create `.planning/phases/05-visual-analytics/05-04-SUMMARY.md`
</output>
